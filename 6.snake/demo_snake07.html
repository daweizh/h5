<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>贪吃蛇</title>
		<style type="text/css">
	        div {
	            width:400px;
	            margin:0 auto;
	        }
	        canvas {
	            background:#abcdef;
	            border:1px solid #000000;
	        }
		</style>
	    <script type="text/javascript">
	    	var field;                      		//定义画布
	    	var context;                    		//定义绘画环境
	    	var fieldWidth;							//定义画布的宽度
	    	var fieldHeight;						//定义画布的高度
	    	var speed           = 160 ;     		//蛇的速度 
	    	var foodX   = foodY = 0;        		//食物食物最开始出现的地方 
	    	var snakeUnitSize   = 8;        		//蛇身单元大小 
    		var x       = y     = snakeUnitSize;   	//蛇最开始出没的地方
    		var direction       = 2;        		//1向上; 2向右; 0向左;  3向下 
		    var snakeLength     = 20;       		//蛇身长度 
		    var pathMap         = [];       		//记录蛇运行路径 
		</script>
	    <script type="text/javascript">
    		/*
     		 * 打开或刷新网页时执行，只执行一次
     		 */
    		window.onload = function(){
        		field   = document.getElementById("field"); 	//得到画布
        		context = field.getContext("2d");           	//得到画布环境
        		fieldWidth = field.width;						//获得画布的实际宽度
        		fieldHeight = field.height;						//获得画布的实际高度
        		putFood();                                  	//随机放置第一份食物
        		window.setInterval(snakeMove, speed);       	//让蛇爬行 
    		}
    	</script>
	    <script type="text/javascript">
		    /*
		     * 让蛇运动的功能，每次走一个蛇身单位
		     */
		    function snakeMove(){ 
		        switch(direction){ 
		            case 1:
		                y = y - snakeUnitSize;
		                break; 
		            case 2:
		                x = x + snakeUnitSize;
		                break; 
		            case 0:
		                x = x - snakeUnitSize;
		                break; 
		            case 3:
		                y = y + snakeUnitSize;
		                break; 
		        } 
				
				if(x>fieldWidth || y>fieldHeight || x<0 || y<0){ 
            		alert("你挂了，继续努力吧!失败原因：碰壁了.....");
            		window.location.reload(); 
        		} 

				for(var i=0; i<pathMap.length; i++){
        		    if( parseInt(pathMap[i].x)==x && parseInt(pathMap[i].y)==y){ 
        		        alert("你挂了，继续努力吧！失败原因：撞到自己了.....");
        		        window.location.reload(); 
        		    } 
        		} 

				if (pathMap.length>snakeLength) {       //保持舍身长度
        		    var firstPart = pathMap.shift();    //删除数组第一项，并且返回原元素 
        		    context.clearRect(firstPart['x'], firstPart['y'], snakeUnitSize, snakeUnitSize); 
        		};

        		pathMap.push({'x':x,'y':y});            //将数据添加到原数组尾部 
				context.fillStyle = "#006699";          //内部填充颜色 
        		context.strokeStyle = "#006699";        //边框颜色 
        		context.fillRect(x, y, snakeUnitSize, snakeUnitSize);  //绘制蛇节

		        if((foodX*8)==x && (foodY*8)==y){                      //吃食物 
		            putFood();
		            snakeLength++; 
		        } 
			}		
    	</script>
	    <script type="text/javascript">
		    /*
		     * 随机放置食物功能
		     */
		    function putFood(){
		    	var size = snakeUnitSize;
		        context.fillStyle 	= "#ff0000";              			//内部填充颜色 
		        context.strokeStyle = "#000000";            			//边框颜色 
		        foodX = Math.ceil(Math.random() * (fieldWidth/size));	//随机生成食物X坐标 
		        if(foodX*size>fieldWidth-size)
		        	foodX = foodX - 1;
		        foodY = Math.ceil(Math.random() * (fieldHeight/size));	//随机生成食物Y坐标
		        if(foodY*size>fieldHeight-size)
		        	foodY = foodY - 1;
		        context.fillRect(foodX*size, foodY*size, size, size);   //绘制矩形 
		    } 
	    </script>
		<script type="text/javascript">
		    /*
		     * 接收键盘按键事件处理功能
		     * ->用来改变蛇的前进方向
		     */
		    document.onkeydown = function(e) {
		        var code = e.keyCode - 37; 
		        switch(code){ 
		            case 1 :                                //定义向上按键
		                direction = 1;
		                break; 
		            case 2 :                                //定义向右按键
		                direction = 2;
		                break; 
		            case 3 :                                //定义向下按键
		                direction = 3;
		                break; 
		            case 0 :                                //定义向左按键
		                direction = 0;
		                break; 
		        } 
		    } 
		</script>
	</head>
	<body>
		<h2 align="center">Greedy Snake</h2>
	    <div>
		    <canvas id="field" width="400" height="600">
		    	This is the field that snake snaking.
		    </canvas>
	    </div>
	</body>
</html>
